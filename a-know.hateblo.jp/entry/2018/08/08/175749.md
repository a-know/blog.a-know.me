---
Title: 読書メモ・詳解システムパフォーマンス 第12章／ベンチマーキング
Category:
- 本
- インフラ関連技術
Date: 2018-08-08T17:57:49+09:00
URL: https://blog.a-know.me/entry/2018/08/08/175749
EditURL: https://blog.hatena.ne.jp/a-know/a-know.hateblo.jp/atom/entry/10257846132608782574
---

「詳解システムパフォーマンス」の読書メモシリーズ・第11弾。

* [https://blog.a-know.me/entry/2017/04/24/192233:title]
* [https://blog.a-know.me/entry/2017/04/27/171809:title]
* [https://blog.a-know.me/entry/2017/04/29/104057:title]
* [https://blog.a-know.me/entry/2017/05/07/120526:title]
* [https://blog.a-know.me/entry/2017/06/11/162926:title]
* [https://blog.a-know.me/entry/2017/07/15/131555:title]
* [https://blog.a-know.me/entry/2017/08/15/121922:title]
* [https://blog.a-know.me/entry/2017/10/30/222529:title]
* [https://blog.a-know.me/entry/2018/07/21/190242:title]
* [https://blog.a-know.me/entry/2018/08/05/175931:title]


[asin:4873117909:detail]

## 感想
- ベンチマーキング、そもそもこれまでにも大した回数やってきてないけれど、それでさえちゃんとしたベンチマーキングとして成立してなかったな、ということがわかった章だった
    - というか、耳が痛いことが多かった......ｗ
- ベンチマークは、ツールなどを使ってただ実施するだけじゃ全然だめで、以下のようなことも同時に考えなければならず、そしてもしそれができたとすれば多くの貴重な学びも同時に得られそうだな、と思った。
    - そもそもそのツールはどんなことをおこなうツールなのか
    - それによりどのようなワークロードが発生するのか・ベンチマークツール自身の動作がベンチマーク結果に影響を及ぼす可能性はないか
    - それは、今回のベンチマークの目的に合致しているのかいないのか



<!-- more -->



## なるほど・知らなかった
- ベンチマーキングには、誤りや見落としの可能性があちこちにあるため、正しく実行しようとすることはとてもむずかしい。
    - 「広く使われているベンチマークの大半には欠陥があり、多くの研究論文は、本当のパフォーマンスを明確に示していない」
- 優れたベンチマークのエッセンス
    - 反復可能
    - 観察可能
    - ポータブル
    - 容易なプレゼンテーション
    - 現実的
    - 実行可能
- 効果的なベンチマーキングとは、「ベンチマークをどのように活用するか」という問題でもある
    - 「分析」と、そこから引き出す「結論」
- ベンチマークを使うには、以下のことを理解している必要がある
    - ベンチマークソフトウェアが何をおこなっているか
    - システムはどのように応答しているか
    - 結果とディスティネーション環境はどのように関係しているか
    - 何がテストされているか
    - 制限要因は何か（一つとは限らない）
    - 結果に影響を与えるような副次的な影響はないか
    - 結果からどのような結果が引き出せるか
    - これらのニーズを満たすためには、ベンチマーク実行中（パッシブベンチマーキング）にシステムのパフォーマンス分析をおこなう（アクティブベンチマーキング）ことが大切。
- ベンチマーキングの禁じ手
    - おざなりなベンチマーキング
        - 「実際に何を計測しているのか」がチェックできておらず、「何をテストしたのか」を理解できていないようでは、ベンチマーキングをうまく実施することはできない
    - ベンチマークに対する根拠のない信頼
        - 「人気のあるものは正しいに違いない」という誤解
        - ベンチマーキングツールの方だけでなく、ベンチマーク結果の解釈にも誤りがある場合がある
    - 分析抜きの数値
        - ベンチマークの結果は調査の最初に過ぎないことが多い、分析内容の詳細を伴う必要がある
            - 『ベンチマークの結果の分析に1週間未満しかかけていない場合には、そのベンチマークはおそらく間違っている』
        - 慎重な分析をする時間が無い場合には、チェックする時間がなかった前提条件をリストアップ、結果に添付する
    - 複雑なベンチマークツール
        - ベンチマークツール自身がベンチマーク分析を邪魔しない
        - ベンチマークのベンチマーキング問題
            - 報告された結果がベンチマークソフトウェア自身によって制限を受けているような状況
    - テスト対象の誤り
        - 対象のワークロードが関係する対象を正しくベンチマーキングできているかどうか。
    - 誤りの無視
        - ベンチマークの結果おこなわれる処理に誤りがあり、それを無視してしまうようなケース。
    - ばらつきの無視
        - 現実のワークロードでは1日の時間帯や期間内の時期などによりばらつきが生じる場合があるが、それを無視した（計測値の平均に基づいた）ベンチマーキングをおこなってしまうケース。
    - 副次的影響の無視
        - 副次的影響：バックアップなどのスケジュール処理の有無・クラウドの場合、見えない別テナントからの影響に対する考慮。
        - 対策としては、ベンチマークを長時間実行すること。
    - 複数の要因の変更
        - 二種類のベンチマークテストをおこない、その結果を比較するようなときのこと。両者の間で異なるあらゆる点に注意し、異なる要因が複数とならないようにする。
        - クラウドインスタンスを用いるような場合には、システムによる外れ値を避けるために、複数のインスタンスをテストして平均を取るなどする。
    - 競合製品のベンチマーキング
        - 競合製品に打ち勝つためだけに、極端な条件でのベンチマーキングをおこなわない。
    - 同士討ち
        - ベンチマーキングをおこなうチームが、開発チームしか知りえないパフォーマンスに関わる設定を知らされておらず、そのままベンチマークしてしまうような問題。
        - その後のバージョンで解決されたパフォーマンス問題を抱える古いバージョンのソフトウェアでベンチマークしてしまうといった問題。
    - 誤解を招くベンチマーク
        - ベンチマークが実際に計測するものは何かについての情報が意図せずに不完全なものになっているか、意図的に必要な情報を省略したときに誤解を招きやすい。
    - ベンチマークスペシャル
        - ベンチマーク最適化とも。
        - 特定のベンチマーキングにおいて高得点を取ることだけを目的として製品を作ってしまうこと。
    - 詐欺
        - 最後の禁じ手。偽りの結果を公表すること。
- ベンチマーキングのタイプ
    - マイクロベンチマーキング
        - 人工的なワークロードを使って特定のタイプのオペレーションだけテストするもの
        - マイクロベンチマーキングの結果を使うときには、ターゲットワークロードへのマッピングが必要となる
        - ターゲットシステムのパフォーマンス分析やモデリングをおこなうと、マイクロベンチマーキングから得られたどの結果がどの程度適切なものかを判断するために役に立つ。
        - 晴れの日のパフォーマンステスト：トップスピードに注目するベンチマーク
        - 曇りの日のパフォーマンステスト：競合、副次的影響、ワークロードのばらつきなどの望ましくない条件下でのテスト
    - シミュレーション
        - 顧客がアプリケーションに与えるワークロードをシミュレートするベンチマーク。マクロベンチマークとも。
        - 問題点としては、ばらつきを無視することがあること。
    - リプレイ
        - トレースログをもとに操作をリプレイして、実際にキャプチャしたクライアントのオペレーションと比較する手法。
        - サーバー上の特長やレイテンシが変わると比較できなくなるために注意が必要
- サニティチェック
    - ベンチマークの結果に何かおかしな部分が含まれていないかどうかをチェックすること。
    - 加えられている制限を突破してしまうような結果になってしまっていないか、等。
- ベンチマークについての問い
    - ベンダーからベンチマークの結果を入手したとき、理解を深め、自分の環境に応用するため（実際に計測されているものは何か、その結果がどれくらい現実的で反復可能なものかを明らかにするため）に、いくつかの問いに答えてみるとよい。
        - 自分でこの結果を再現することができるか？
        - その他、一般的な問いやCPU/メモリ関連・ストレージ関連・ネットワーク関連のベンチマークについての問い。
            - P.648 - 649


<div>
<br>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- article-bottom2 -->
<ins class="adsbygoogle"
     style="display:inline-block;width:300px;height:250px"
     data-ad-client="ca-pub-3463034538369189"
     data-ad-slot="5274552934"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>

<a href="https://bit.ly/grass-graph" target='blank' rel="nofollow"><img src="https://cdn-ak.f.st-hatena.com/images/fotolife/a/a-know/20170405/20170405220342.png"></a>
<br>
</div>

<div>
<a href='https://cloud.feedly.com/#subscription%2Ffeed%2Fhttp%3A%2F%2Fblog.a-know.me%2Ffeed'  target='blank'><img id='feedlyFollow' src='https://s3.feedly.com/img/follows/feedly-follow-rectangle-volume-small_2x.png' alt='follow us in feedly' width='65' height='20'></a>



<iframe src="https://blog.hatena.ne.jp/a-know/a-know.hateblo.jp/subscribe/iframe" allowtransparency="true" frameborder="0" scrolling="no" width="150" height="28"></iframe>
</div>



<script src="https://moshi-moshi.moshimo.works/moshimoshi/a_know_blog/2018-08-08-175749?title=%e8%aa%ad%e6%9b%b8%e3%83%a1%e3%83%a2%e3%83%bb%e8%a9%b3%e8%a7%a3%e3%82%b7%e3%82%b9%e3%83%86%e3%83%a0%e3%83%91%e3%83%95%e3%82%a9%e3%83%bc%e3%83%9e%e3%83%b3%e3%82%b9%20%e7%ac%ac12%e7%ab%a0%ef%bc%8f%e3%83%99%e3%83%b3%e3%83%81%e3%83%9e%e3%83%bc%e3%82%ad%e3%83%b3%e3%82%b0"></script>
